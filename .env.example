# =============================================================================
# AR Collections & Dunning — Environment Configuration Template
# =============================================================================
#
# This project uses TWO separate env files (each loaded by a different system):
#
#   FILE 1 — .env  (copy this file, rename it)
#     Loaded by: dotenv.config() in all TypeScript/Node source files
#     Contains:  Azure OpenAI, Dynamics 365, Graph API credentials, app settings
#     Command:   cp .env.example .env
#
#   FILE 2 — env/.env.local  (created automatically on first provision)
#     Loaded by: M365 Agents Toolkit during provision and deployment
#     Contains:  TEAMS_APP_ID, API_BASE_URL, M365 title/app IDs
#     Most values are written by the Toolkit; only API_BASE_URL is set manually.
#
# Both files are gitignored — only this .env.example is committed.
# See docs/SETUP.md for full configuration instructions.
# =============================================================================


# ─────────────────────────────────────────────────────────────────────────────
# SECTION 1 — API SERVER CREDENTIALS  →  copy to .env
# ─────────────────────────────────────────────────────────────────────────────

# Azure OpenAI
# Resource endpoint and deployment from Azure Portal → Azure OpenAI → Keys and Endpoint
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-5
AZURE_OPENAI_API_VERSION=2025-01-01-preview

# Microsoft Graph — Interactive Browser Authentication
# A browser opens automatically on first run; emails/Teams messages sent from your mailbox.
# Register an app in Azure AD → Authentication → Mobile and desktop applications platform.
# Add redirect URI: http://localhost:3000  |  Enable "Allow public client flows"
# Required permissions: Mail.Send, Chat.Create, ChatMessage.Send, User.Read, User.ReadBasic.All
GRAPH_CLIENT_ID=your-app-registration-client-id
GRAPH_TENANT_ID=your-tenant-id

# Dynamics 365 ERP — OAuth2 Client Credentials Flow
# Same app registration as Graph (or a separate one).
# Grant Dynamics CRM → user_impersonation permission and create an Application User in D365.
ERP_API_ENDPOINT=https://your-org.api.crm.dynamics.com/api/data/v9.2
ERP_CLIENT_ID=your-app-registration-client-id
ERP_CLIENT_SECRET=your-client-secret
ERP_TENANT_ID=your-tenant-id
ERP_RESOURCE=https://your-org.api.crm.dynamics.com/

# Application Settings
PORT=3000
RISK_THRESHOLD_HIGH=0.5
RISK_THRESHOLD_MEDIUM=0.3

# Email & Teams Testing
# TEST_COLLECTIONS_EMAIL must be a DIFFERENT user from your signed-in Graph account.
# Teams cannot create a one-on-one chat with yourself.
TEST_CUSTOMER_EMAIL=your-email@domain.com
TEST_COLLECTIONS_EMAIL=colleague@yourorg.com

# Demo Mode
# true  = mock data, no Dynamics 365 connection needed (great for demos)
# false = queries live Dynamics 365 data
DEMO_MODE=false


# ─────────────────────────────────────────────────────────────────────────────
# SECTION 2 — M365 AGENTS TOOLKIT  →  env/.env.local  (auto-managed)
# ─────────────────────────────────────────────────────────────────────────────
#
# env/.env.local is created and maintained by the M365 Agents Toolkit.
# Most values are written automatically during provision — you only need to
# set API_BASE_URL before the first provision.
#
# AUTO-POPULATED BY TOOLKIT (do not edit manually):
#   TEAMS_APP_ID        — written by teamsApp/create on first provision
#   APP_NAME_SUFFIX     — "local" for local dev, do not change
#   TEAMSFX_ENV         — "local" for local dev, do not change
#   TEAMS_APP_TENANT_ID — your M365 tenant GUID, written by Toolkit
#   M365_TITLE_ID       — written by teamsApp/extendToM365
#   M365_APP_ID         — written by teamsApp/extendToM365
#
# SET MANUALLY — API_BASE_URL:
#   The publicly reachable HTTPS URL for the REST API (npm run api-server → port 3000).
#   Required so M365 Copilot Chat can call the API from the cloud.
#   No trailing slash. Update this whenever your tunnel URL changes, then re-provision.
#
#   Option A — VS Code Dev Tunnel (recommended, no install):
#     1. npm run api-server
#     2. VS Code → PORTS tab → Forward Port 3000 → Port Visibility → Public
#     3. Copy the https://*.devtunnels.ms URL (no trailing slash)
#
#   Option B — ngrok:
#     1. npm run api-server
#     2. ngrok http 3000  →  copy the https://*.ngrok-free.app URL
#
#   Option C — Azure App Service (production):
#     Deploy the API and use the Azure URL, e.g. https://ar-collections-api.azurewebsites.net
#
# Example env/.env.local (auto-created after first provision):
#   TEAMS_APP_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
#   APP_NAME_SUFFIX=local
#   TEAMSFX_ENV=local
#   TEAMS_APP_TENANT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
#   M365_TITLE_ID=U_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
#   M365_APP_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
#   API_BASE_URL=https://your-tunnel-url.devtunnels.ms
