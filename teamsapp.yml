# yaml-language-server: $schema=https://aka.ms/teams-toolkit/1.0.0/yaml.schema.json
#
# AR Collections & Dunning — Teams App Toolkit Configuration
#
# Deploy the declarative agent to Microsoft 365 Copilot Chat using:
#   Teams Toolkit for VS Code  → "Provision" then "Deploy"
#   Teams Toolkit CLI           → teamsapp provision && teamsapp deploy
#
# Before provisioning:
#   1. Copy env/.env.dev.template to env/.env.dev
#   2. Fill in API_BASE_URL (the URL where npm run api-server is reachable)
#   3. Run: npm install && npm run api-server   (keep running during sideloading)

version: "1.1.0"

projectType: declarativeAgent

environmentFolderPath: ./env

# ---------------------------------------------------------------------------
# Provision — create/update the Teams app registration
# ---------------------------------------------------------------------------
provision:
  - uses: teamsApp/create
    with:
      name: AR-Collections-${{TEAMSFX_ENV}}
    writeToEnvironmentFile:
      teamsAppId: TEAMS_APP_ID

  - uses: teamsApp/zipAppPackage
    with:
      manifestPath: ./appPackage/manifest.json
      outputZipPath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip
      outputFolder: ./appPackage/build

  - uses: teamsApp/validateAppPackage
    with:
      appPackagePath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip

  - uses: teamsApp/update
    with:
      appPackagePath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip

# ---------------------------------------------------------------------------
# Publish — sideload to your M365 tenant for testing
# ---------------------------------------------------------------------------
publish:
  - uses: teamsApp/zipAppPackage
    with:
      manifestPath: ./appPackage/manifest.json
      outputZipPath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip
      outputFolder: ./appPackage/build

  - uses: teamsApp/publishAppPackage
    with:
      packages:
        - ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip
    writeToEnvironmentFile:
      publishedAppId: TEAMS_APP_PUBLISHED_APP_ID
projectId: c9d4b1bf-d932-4a53-a4b5-42f773dc1a8b
